import{e as g,f as b}from"./FileSaver.min-DWN2pOXY.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";$("#supplierId").select2({placeholder:"Pilih Supplier",dropdownParent:$("#supplierId").parent(),ajax:{url:"/master/supplier/get-supplier-list",processResults:function(a){return{results:a.map(function(n){return{id:n.id,text:n.name}})}}},language:{noResults:function(){return"Supplier tidak ditemukan..."}}});var o=$("#poDatatable").DataTable({processing:!0,serverSide:!0,scrollX:!0,scrollY:"415px",ajax:"/transaction/purchase-order/browse-po",columns:[{data:"action",name:"action",sortable:!1},{data:"po_code",name:"po_code"},{data:"purchase_date",name:"purchase_date",render:function(a,n,l){return moment(a).format("DD-MM-YYYY HH:mm:ss")}},{data:"supplier",name:"supplier"},{data:"total_item",name:"total_item"},{data:"grand_total",name:"grand_total",render:function(a,n,l){return`<span>Rp ${parseFloat(a).toLocaleString("id-ID")}</span>`}},{data:"status",name:"status",render:function(a,n,l){return`<span class="d-flex justify-content-center badge rounded-pill bg-label-${a=="Dalam Proses"?"info":"success"}">${a}</span>`}},{data:"remarks",name:"remarks",sortable:!1}],order:[1,"desc"],language:{lengthMenu:"Tampilkan _MENU_ data",zeroRecords:"Data tidak ditemukan...",info:"Halaman _PAGE_ dari _PAGES_",infoEmpty:"Data tidak ditemukan ",infoFiltered:"(Difilter dari _MAX_ data)"},dom:'<"row"<"px-4 my-2 col-12"l>tr<"px-4 my-1 col-md-6"i><"px-4 mt-1 mb-3 col-md-6"p>>'}),w=$(`
  <a class="btn btn-primary float-end ms-3" href="purchase-order/create">Tambah</a>
  <a class="btn btn-success float-end export" href="purchase-order/export">Export</a>
`);$(".dataTables_length").append(w);$("#startDate")&&$("#endDate")&&($("#startDate").flatpickr({dateFormat:"d-m-Y"}),$("#endDate").flatpickr({dateFormat:"d-m-Y"}));$("input.dt-input, select.dt-input").on("keyup change",function(){o.column($(this).attr("data-column")).search($(this).val()).draw()});$("input.dt-date-input").on("change",function(){if($("#startDate").val()!=""&&$("#endDate").val()!=""){const a=$("#startDate").val()+","+$("#endDate").val();o.column(2).search(a).draw()}});$(document).on("click",".finish-po",function(a){a.preventDefault();const n=$(this).attr("href"),l=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"Apakah Anda yakin?",text:"Transaksi yang telah diselesaikan tidak dapat diedit atau dihapus lagi!",icon:"warning",confirmButtonText:"Ya, selesaikan!",customClass:{confirmButton:"btn btn-danger me-3 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"}}).then(s=>{s.isConfirmed&&$.ajax({url:n,type:"PUT",headers:{"X-CSRF-TOKEN":l},success:function(c){Swal.fire({title:"Success",text:"Transaksi Berhasil Diselesaikan",icon:"success",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}});const i=o.page.info(),d=o.order(),t=o.search();o.ajax.reload(function(){o.page(i.page).draw(!1),o.order(d).draw(!1),o.search(t).draw(!1)})},error:function(c,i,d){Swal.fire({title:"Error",text:d,icon:"error",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}})}})})});$(".export").on("click",function(a){a.preventDefault();const n=$(this).attr("href"),l=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:n,type:"GET",data:{po_code:$("#poCode").val(),supplier_id:$("#supplierId").val(),start_date:$("#startDate").val(),end_date:$("#endDate").val(),status:$("#status").val()},headers:{"X-CSRF-TOKEN":l},success:function(s){console.log(s);const c=$("#startDate").val()&&$("#endDate").val()?$("#startDate").val()+" - "+$("#endDate").val():"",i="Laporan Transaksi Penjualan "+(c?`(${c})`:""),d=new g.Workbook,t=d.addWorksheet(i);t.addRow([i]).eachCell(e=>{e.font={size:16,bold:!0,underline:!0}}),t.addRow([]);const m=t.addRow(["Kode PO","Tanggal Pembelian","Supplier","Grand Total","Item","Status","Barang","Harga Beli","Qty","Total Harga"]);m.font={bold:!0,size:12},m.alignment={horizontal:"center",vertical:"middle"},m.eachCell(e=>{e.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFF00"},bgColor:{argb:"FF0000FF"}}}),s.forEach((e,p)=>{t.addRow([e.po_code,e.purchase_date,e.supplier_name,"Rp "+e.grand_total.toLocaleString("id-ID"),e.total_item,e.status,"","","",""]).eachCell((r,u)=>{p%2==0?r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"fff2f2f2"}}:r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffeeece1"}},u<7&&(r.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}),u==10&&(r.border={right:{style:"thin"}})}),e.po_detail.forEach((r,u)=>{t.addRow(["","","","","","",r.product_name,"Rp "+r.purchase_price.toLocaleString("id-ID"),r.quantity+" "+r.product_uom,"Rp "+r.total_price.toLocaleString("id-ID")]).eachCell((f,h)=>{p%2==0?f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"fff2f2f2"}}:f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffeeece1"}},h>=7?f.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}:h<7&&p==s.length-1&&u==e.po_detail.length-1&&(f.border={bottom:{style:"thin"}})})})}),t.getColumn(1).width=13,t.getColumn(2).width=20,t.getColumn(3).width=15,t.getColumn(4).width=15,t.getColumn(5).width=7,t.getColumn(6).width=15,t.getColumn(7).width=20,t.getColumn(8).width=15,t.getColumn(9).width=15,t.getColumn(10).width=15,d.xlsx.writeBuffer().then(e=>{const p=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});b.saveAs(p,i+".xlsx")})},error:function(s,c,i){Swal.fire({title:"Error",text:"Export Gagal: "+i,icon:"error",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}})}})});
