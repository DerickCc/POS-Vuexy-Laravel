import{e as b,f as w}from"./FileSaver.min-DWN2pOXY.js";import"./_commonjsHelpers-BosuxZz1.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";function g(t){new Cleave($(t),{numeral:!0,numeralDecimalMark:",",delimiter:".",numeralThousandsGroupStyle:"thousand",numeralDecimalScale:2})}$("#customerId").select2({placeholder:"Pilih Customer",dropdownParent:$("#customerId").parent(),ajax:{url:"/master/customer/get-customer-list",processResults:function(t){return{results:t.map(function(n){return{id:n.id,text:n.name}})}}},language:{noResults:function(){return"Customer tidak ditemukan..."}}});var i=$("#soDatatable").DataTable({processing:!0,serverSide:!0,scrollX:!0,scrollY:"415px",ajax:"/transaction/sales-order/browse-so",columns:[{data:"action",name:"action",sortable:!1},{data:"so_code",name:"so_code"},{data:"sales_date",name:"sales_date",render:function(t,n,s){return moment(t).format("DD-MM-YYYY HH:mm:ss")}},{data:"customer",name:"customer"},{data:"sub_total",name:"sub_total",render:function(t,n,s){return`<span>Rp ${parseFloat(t).toLocaleString("id-ID")}</span>`}},{data:"discount",name:"discount",render:function(t,n,s){return`<span>Rp ${parseFloat(t).toLocaleString("id-ID")}</span>`}},{data:"grand_total",name:"grand_total",render:function(t,n,s){return`<span>Rp ${parseFloat(t).toLocaleString("id-ID")}</span>`}},{data:"paid_amount",name:"paid_amount",render:function(t,n,s){return`<span>Rp ${parseFloat(t).toLocaleString("id-ID")}</span>`}},{data:"status",name:"status",render:function(t,n,s){return`<span class="d-flex justify-content-center badge rounded-pill bg-label-${{"Belum Lunas":"info",Lunas:"success",Batal:"danger"}[t]}">${t}</span>`}},{data:"created_by",name:"created_by"},{data:"remarks",name:"remarks",sortable:!1}],order:[1,"desc"],language:{lengthMenu:"Tampilkan _MENU_ data",zeroRecords:"Data tidak ditemukan...",info:"Halaman _PAGE_ dari _PAGES_",infoEmpty:"Data tidak ditemukan ",infoFiltered:"(Difilter dari _MAX_ data)"},dom:'<"row"<"px-4 my-2 col-12"l>tr<"px-4 my-1 col-md-6"i><"px-4 mt-1 mb-3 col-md-6"p>>'}),v=$(`
  <a class="btn btn-primary float-end ms-3" href="sales-order/create">Tambah</a>
  <a class="btn btn-success float-end export" href="sales-order/export">Export</a>
`);$(".dataTables_length").append(v);$("#startDate")&&$("#endDate")&&($("#startDate").flatpickr({dateFormat:"d-m-Y"}),$("#endDate").flatpickr({dateFormat:"d-m-Y"}));$("input.dt-input, select.dt-input").on("keyup change",function(){i.column($(this).attr("data-column")).search($(this).val()).draw()});$("input.dt-date-input").on("change",function(){if($("#startDate").val()!=""&&$("#endDate").val()!=""){const t=$("#startDate").val()+","+$("#endDate").val();i.column(2).search(t).draw()}});$(document).on("click",".cancel-so",function(t){t.preventDefault();const n=$(this).attr("href");console.log(n);const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content");Swal.fire({title:"Apakah Anda yakin?",text:"Transaksi yang telah dibatalkan tidak dapat dikembalikan lagi!",icon:"warning",confirmButtonText:"Ya, batalkan!",customClass:{confirmButton:"btn btn-danger me-3 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"}}).then(o=>{o.isConfirmed&&$.ajax({url:n,type:"PUT",headers:{"X-CSRF-TOKEN":s},success:function(c){Swal.fire({title:"Success",text:"Transaksi Berhasil Dibatalkan",icon:"success",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}});const l=i.page.info(),u=i.order(),e=i.search();i.ajax.reload(function(){i.page(l.page).draw(!1),i.order(u).draw(!1),i.search(e).draw(!1)})},error:function(c,l,u){Swal.fire({title:"Error",text:u,icon:"error",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}})}})})});var y=0;$(document).on("click",".payment-modal",function(){y=$(this).data("id");var t=$(this).data("so-code"),n=$(this).data("grand-total"),s=$(this).data("paid-amount");$("#soCodeM").val(t),$("#grandTotalM").val(n),$("#paidAmountM").val(s),$("#shouldBePaidM").val(n-s),g("#grandTotalM"),g("#paidAmountM"),g("#shouldBePaidM"),g("#paymentAmountM"),$("#paymentAmountM").on("keyup change",function(){const o=$(this).val().replace(/\./g,"");if(o>n-s){$("#paymentAmountM").val($("#shouldBePaidM").val());return}else if(o<0){$("#paymentAmountM").val(0);return}$("#paymentLeftM").val(n-s-o),g("#paymentLeftM")}),$("#paymentModal").modal("show")});$("#submitPaymentModalBtn").on("click",function(){const t=$("#paymentAmountM").val().replace(/\./g,"");Swal.fire({title:"Cek Sekali Lagi!",text:"Pastikan jumlah yang dibayarkan telah sesuai.",icon:"warning",confirmButtonText:"Simpan",customClass:{confirmButton:"btn btn-warning me-3 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"}}).then(n=>{if(n.isConfirmed){const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:`/transaction/sales-order/${y}/update-paid-amount`,type:"PUT",headers:{"X-CSRF-TOKEN":s},data:{paid_amount:t},success:function(o){$("#paymentModal").modal("hide"),Swal.fire({title:"Success",text:"Pembayaran Berhasil Disimpan",icon:"success",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}});const c=i.page.info(),l=i.order(),u=i.search();i.ajax.reload(function(){i.page(c.page).draw(!1),i.order(l).draw(!1),i.search(u).draw(!1)})},error:function(o,c,l){Swal.fire({title:"Error",text:l,icon:"error",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}})}})}})});$("#paymentModal").on("hidden.bs.modal",function(){$("#paymentAmountM").val(0),$("#paymentLeftM").val(0),y=0,console.log("hidden")});$(".export").on("click",function(t){t.preventDefault();const n=$(this).attr("href"),s=document.querySelector('meta[name="csrf-token"]').getAttribute("content");$.ajax({url:n,type:"GET",data:{so_code:$("#soCode").val(),customer_id:$("#customerId").val(),start_date:$("#startDate").val(),end_date:$("#endDate").val(),status:$("#status").val()},headers:{"X-CSRF-TOKEN":s},success:function(o){console.log(o);const c=$("#startDate").val()&&$("#endDate").val()?$("#startDate").val()+" - "+$("#endDate").val():"",l="Laporan Transaksi Pembelian "+(c?`(${c})`:""),u=new b.Workbook,e=u.addWorksheet(l);e.addRow([l]).eachCell(a=>{a.font={size:16,bold:!0,underline:!0}}),e.addRow([]);const h=e.addRow(["No. Invoice","Tanggal Penjualan","Pelanggan","Jenis Pembayaran","Sub Total","Diskon","Grand Total","Telah Dibayar","Status","Barang / Jasa","Harga Jual","Qty","Total Harga","Keuntungan"]);h.font={bold:!0,size:12},h.alignment={horizontal:"center",vertical:"middle"},h.eachCell(a=>{a.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFFF00"},bgColor:{argb:"FF0000FF"}}}),o.forEach((a,m)=>{e.addRow([a.so_code,a.sales_date,a.customer_name,a.payment_type,"Rp "+a.sub_total.toLocaleString("id-ID"),"Rp "+a.discount.toLocaleString("id-ID"),"Rp "+a.grand_total.toLocaleString("id-ID"),"Rp "+a.paid_amount.toLocaleString("id-ID"),a.status,"","","","",""]).eachCell((r,f)=>{m%2==0?r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"fff2f2f2"}}:r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffeeece1"}},f<10&&(r.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}),f==14&&(r.border={right:{style:"thin"}})}),a.so_product_detail.forEach((r,f)=>{e.addRow(["","","","","","","","","",r.product_name,"Rp "+r.selling_price.toLocaleString("id-ID"),r.quantity+" "+r.product_uom,"Rp "+r.total_price.toLocaleString("id-ID"),"Rp "+r.profit.toLocaleString("id-ID")]).eachCell((d,p)=>{m%2==0?d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"fff2f2f2"}}:d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffeeece1"}},p>=10?d.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}:p<10&&m==o.length-1&&f==a.so_product_detail.length-1&&a.so_service_detail.length==0&&(d.border={bottom:{style:"thin"}})})}),a.so_service_detail.forEach((r,f)=>{e.addRow(["","","","","","","","","",r.service_name,"Rp "+r.selling_price.toLocaleString("id-ID"),r.quantity,"Rp "+r.total_price.toLocaleString("id-ID"),"Rp "+r.total_price.toLocaleString("id-ID")]).eachCell((d,p)=>{m%2==0?d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"fff2f2f2"}}:d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"ffeeece1"}},p>=10?d.border={top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}:p<10&&m==o.length-1&&f==a.so_service_detail.length-1&&(d.border={bottom:{style:"thin"}})})})}),e.getColumn(1).width=13,e.getColumn(2).width=20,e.getColumn(3).width=20,e.getColumn(4).width=18,e.getColumn(5).width=15,e.getColumn(6).width=15,e.getColumn(7).width=15,e.getColumn(8).width=15,e.getColumn(9).width=11,e.getColumn(10).width=20,e.getColumn(11).width=15,e.getColumn(12).width=12,e.getColumn(13).width=15,e.getColumn(14).width=15,u.xlsx.writeBuffer().then(a=>{const m=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});w.saveAs(m,l+".xlsx")})},error:function(o,c,l){Swal.fire({title:"Error",text:"Export Gagal: "+l,icon:"error",customClass:{confirmButton:"btn btn-primary me waves-effect waves-light"}})}})});
